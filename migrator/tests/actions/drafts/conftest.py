# -*- coding: utf-8 -*-
#
# Copyright (C) 2023 CERN.
#
# ZenodoRDM is free software; you can redistribute it and/or modify it
# under the terms of the MIT License; see LICENSE file for more details.

"""Migrator tests configuration."""

import pytest
from invenio_rdm_migrator.load.postgresql.transactions.operations import OperationType


@pytest.fixture()
def create_draft_tx():
    """Transaction data to create a draft.

    As it would be after the extraction step.
    """
    return {
        "tx_id": 533724568,
        "operations": [
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "K",
                    "object_type": None,
                    "object_uuid": None,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829710016"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724568,
                    "lsn": 1375829710016,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132091,
                    "pid_type": "depid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829710456"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724568,
                    "lsn": 1375829710456,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "0e12b4b6-9cc7-46df-9a04-c11c478de211",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 0,
                    "quota_size": 50000000000,
                    "max_file_size": 50000000000,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829718624"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724568,
                    "lsn": 1375829718624,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                    "json": '{"recid": 1217215,"$schema": "https://zenodo.org/schemas/deposits/records/record-v1.0.0.json","_buckets": {"deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","owners": [86261],"status": "draft","created_by": 86261},"conceptrecid": "1217214"}',
                    "version_id": 1,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829740696"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724568,
                    "lsn": 1375829740696,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
        ],
    }


@pytest.fixture()
def update_draft_tx():
    """Transaction data to update a draft.

    As it would be after the extraction step.
    """
    return {
        "tx_id": 533724569,
        "operations": [
            {
                "after": {
                    "created": "2021-05-01T00:00:00",
                    "updated": "2023-06-29T13:00:00",
                    "id": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                    "json": '{"doi": "","recid": 1217215,"title": "update test","$schema": "https://zenodo.org/schemas/deposits/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"owners": [86261],"status": "draft","created_by": 86261},"creators": [{"name": "me"}],"description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 2,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929339,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829782712","1375829785112"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724586,
                    "lsn": 1375829785112,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045929643,
                "transaction": None,
            },
        ],
    }


@pytest.fixture()
def draft_publish_tx():
    """Transaction data to publish a draft.

    As it would be after the extraction step.
    """
    return {
        "tx_id": 533724590,
        "operations": [
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "K",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829894912"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829894912,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829902832"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829902832,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132092,
                    "pid_type": "doi",
                    "pid_value": "10.5072/zenodo.1217215",
                    "pid_provider": "datacite",
                    "status": "K",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829903320"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829903320,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132093,
                    "pid_type": "oai",
                    "pid_value": "oai:zenodo.org:1217215",
                    "pid_provider": "oai",
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829926648"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829926648,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132094,
                    "pid_type": "doi",
                    "pid_value": "10.5072/zenodo.1217214",
                    "pid_provider": "datacite",
                    "status": "K",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829939792"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829939792,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                    "uri": "root://eosmedia.cern.ch//eos/media/zenodo/test/data/e9/4b/243e-9c0c-44df-bd1f-6decc374cf78/data",
                    "storage_class": "S",
                    "size": 1562554,
                    "checksum": "md5:3cc016be06f2be46d3a438db23c40bf3",
                    "readable": True,
                    "writable": False,
                    "last_check_at": 1688045937960147,
                    "last_check": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829940424"]',
                    "schema": "public",
                    "table": "files_files",
                    "txId": 533724641,
                    "lsn": 1375829940424,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "0e12b4b6-9cc7-46df-9a04-c11c478de211",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 1562554,
                    "quota_size": 50000000000,
                    "max_file_size": 50000000000,
                    "locked": True,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829948808"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829948808,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 0,
                    "quota_size": 50000000000,
                    "max_file_size": None,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829948944"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829948944,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 0,
                    "quota_size": 50000000000,
                    "max_file_size": None,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829956640"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829956640,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "bucket_id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "key": "IMG_3535.jpg",
                    "version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba",
                    "file_id": None,
                    "_mimetype": None,
                    "is_head": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829956776"]',
                    "schema": "public",
                    "table": "files_object",
                    "txId": 533724641,
                    "lsn": 1375829956776,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 1562554,
                    "quota_size": 50000000000,
                    "max_file_size": None,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829970576"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829970576,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                    "uri": "root://eosmedia.cern.ch//eos/media/zenodo/test/data/e9/4b/243e-9c0c-44df-bd1f-6decc374cf78/data",
                    "storage_class": "S",
                    "size": 1562554,
                    "checksum": "md5:3cc016be06f2be46d3a438db23c40bf3",
                    "readable": True,
                    "writable": False,
                    "last_check_at": 1688045937960147,
                    "last_check": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829970712"]',
                    "schema": "public",
                    "table": "files_files",
                    "txId": 533724641,
                    "lsn": 1375829970712,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "bucket_id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "key": "IMG_3535.jpg",
                    "version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba",
                    "file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                    "_mimetype": None,
                    "is_head": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829970976"]',
                    "schema": "public",
                    "table": "files_object",
                    "txId": 533724641,
                    "lsn": 1375829970976,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": "2023-06-29T13:00:00",
                    "updated": "2023-06-29T13:00:00",
                    "id": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "json": '{"doi": "10.5072/zenodo.1217215","_oai": {"id": "oai:zenodo.org:1217215"},"recid": 1217215,"title": "test","_files": [{"key": "IMG_3535.jpg","size": 1562554,"type": "jpg","bucket": "930d05e3-7088-4f58-ba60-cd85fb3138c1","file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78","checksum": "md5:3cc016be06f2be46d3a438db23c40bf3","version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba"}],"owners": [86261],"$schema": "https://zenodo.org/schemas/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"record": "930d05e3-7088-4f58-ba60-cd85fb3138c1","deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","pid": {"type": "recid","value": "1217215","revision_id": 0},"owners": [86261],"status": "published","created_by": 86261},"creators": [{"name": "me"}],"conceptdoi": "10.5072/zenodo.1217214","description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 1,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829982232"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724641,
                    "lsn": 1375829982232,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "struct",
                        "fields": [
                            {
                                "type": "int64",
                                "optional": True,
                                "name": "io.debezium.time.MicroTimestamp",
                                "version": 1,
                                "field": "created",
                            },
                            {
                                "type": "int64",
                                "optional": True,
                                "name": "io.debezium.time.MicroTimestamp",
                                "version": 1,
                                "field": "updated",
                            },
                            {
                                "type": "string",
                                "optional": False,
                                "name": "io.debezium.data.Uuid",
                                "version": 1,
                                "field": "id",
                            },
                            {
                                "type": "string",
                                "optional": True,
                                "name": "io.debezium.data.Json",
                                "version": 1,
                                "field": "json",
                            },
                            {"type": "int32", "optional": True, "field": "version_id"},
                            {
                                "type": "int64",
                                "optional": False,
                                "field": "transaction_id",
                            },
                            {
                                "type": "int64",
                                "optional": True,
                                "field": "end_transaction_id",
                            },
                            {
                                "type": "int16",
                                "optional": False,
                                "field": "operation_type",
                            },
                        ],
                        "optional": True,
                        "name": "zenodo-migration.public.Value",
                        "field": "before",
                    },
                    {
                        "type": "struct",
                        "fields": [
                            {
                                "type": "int64",
                                "optional": True,
                                "name": "io.debezium.time.MicroTimestamp",
                                "version": 1,
                                "field": "created",
                            },
                            {
                                "type": "int64",
                                "optional": True,
                                "name": "io.debezium.time.MicroTimestamp",
                                "version": 1,
                                "field": "updated",
                            },
                            {
                                "type": "string",
                                "optional": False,
                                "name": "io.debezium.data.Uuid",
                                "version": 1,
                                "field": "id",
                            },
                            {
                                "type": "string",
                                "optional": True,
                                "name": "io.debezium.data.Json",
                                "version": 1,
                                "field": "json",
                            },
                            {"type": "int32", "optional": True, "field": "version_id"},
                            {
                                "type": "int64",
                                "optional": False,
                                "field": "transaction_id",
                            },
                            {
                                "type": "int64",
                                "optional": True,
                                "field": "end_transaction_id",
                            },
                            {
                                "type": "int16",
                                "optional": False,
                                "field": "operation_type",
                            },
                        ],
                        "optional": True,
                        "name": "zenodo-migration.public.Value",
                        "field": "after",
                    },
                    {
                        "type": "struct",
                        "fields": [
                            {"type": "string", "optional": False, "field": "version"},
                            {"type": "string", "optional": False, "field": "connector"},
                            {"type": "string", "optional": False, "field": "name"},
                            {"type": "int64", "optional": False, "field": "ts_ms"},
                            {
                                "type": "string",
                                "optional": True,
                                "name": "io.debezium.data.Enum",
                                "version": 1,
                                "parameters": {
                                    "allowed": "True,last,False,incremental"
                                },
                                "default": "False",
                                "field": "snapshot",
                            },
                            {"type": "string", "optional": False, "field": "db"},
                            {"type": "string", "optional": True, "field": "sequence"},
                            {"type": "string", "optional": False, "field": "schema"},
                            {"type": "string", "optional": False, "field": "table"},
                            {"type": "int64", "optional": True, "field": "txId"},
                            {"type": "int64", "optional": True, "field": "lsn"},
                            {"type": "int64", "optional": True, "field": "xmin"},
                        ],
                        "optional": False,
                        "name": "io.debezium.connector.postgresql.Source",
                        "field": "source",
                    },
                    {"type": "string", "optional": False, "field": "op"},
                    {"type": "int64", "optional": True, "field": "ts_ms"},
                    {
                        "type": "struct",
                        "fields": [
                            {"type": "string", "optional": False, "field": "id"},
                            {
                                "type": "int64",
                                "optional": False,
                                "field": "total_order",
                            },
                            {
                                "type": "int64",
                                "optional": False,
                                "field": "data_collection_order",
                            },
                        ],
                        "optional": True,
                        "name": "event.block",
                        "version": 1,
                        "field": "transaction",
                    },
                ],
                "optional": False,
                "name": "zenodo-migration.public.Envelope",
                "version": 1,
            },
            {
                "after": {
                    "record_id": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "bucket_id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830001816"]',
                    "schema": "public",
                    "table": "records_buckets",
                    "txId": 533724641,
                    "lsn": 1375830001816,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id_community": "zenodo",
                    "id_record": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "id_user": None,
                    "expires_at": None,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830011336"]',
                    "schema": "public",
                    "table": "communities_community_record",
                    "txId": 533724641,
                    "lsn": 1375830011336,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "json": '{"doi": "10.5072/zenodo.1217215","_oai": {"id": "oai:zenodo.org:1217215"},"recid": 1217215,"title": "test","_files": [{"key": "IMG_3535.jpg","size": 1562554,"type": "jpg","bucket": "930d05e3-7088-4f58-ba60-cd85fb3138c1","file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78","checksum": "md5:3cc016be06f2be46d3a438db23c40bf3","version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba"}],"owners": [86261],"$schema": "https://zenodo.org/schemas/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"record": "930d05e3-7088-4f58-ba60-cd85fb3138c1","deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","pid": {"type": "recid","value": "1217215","revision_id": 0},"owners": [86261],"status": "published","created_by": 86261},"creators": [{"name": "me"}],"conceptdoi": "10.5072/zenodo.1217214","description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 2,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830032456"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724641,
                    "lsn": 1375830032456,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": "2023-06-29T13:00:00",
                    "updated": "2023-06-29T13:00:00",
                    "id": 12132089,
                    "pid_type": "recid",
                    "pid_value": "1217214",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": None,
                    "object_uuid": None,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830034952"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375830034952,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830035400"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375830035400,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "6519f1ac-1b3c-4691-bb1e-a507280102a4",
                    "pid_id": 12132090,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830035536"]',
                    "schema": "public",
                    "table": "pidstore_redirect",
                    "txId": 533724641,
                    "lsn": 1375830035536,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132089,
                    "pid_type": "recid",
                    "pid_value": "1217214",
                    "pid_provider": None,
                    "status": "M",
                    "object_type": None,
                    "object_uuid": "6519f1ac-1b3c-4691-bb1e-a507280102a4",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830050256"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375830050256,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "before": {
                    "created": 0,
                    "updated": 0,
                    "parent_id": 12132090,
                    "child_id": 12132091,
                    "relation_type": 0,
                    "index": None,
                },
                "after": None,
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830064184"]',
                    "schema": "public",
                    "table": "pidrelations_pidrelation",
                    "txId": 533724641,
                    "lsn": 1375830064184,
                    "xmin": None,
                },
                "op": "d",
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                    "json": '{"doi": "10.5072/zenodo.1217215","_oai": {"id": "oai:zenodo.org:1217215"},"recid": 1217215,"title": "test","owners": [86261],"$schema": "https://zenodo.org/schemas/deposits/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","pid": {"type": "recid","value": "1217215","revision_id": 0},"owners": [86261],"status": "published","created_by": 86261},"creators": [{"name": "me"}],"conceptdoi": "10.5072/zenodo.1217214","communities": ["zenodo"],"description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 3,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830064256"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724641,
                    "lsn": 1375830064256,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938758,
                "transaction": None,
            },
            {
                "after": {
                    "created": "2023-06-29T13:00:00",
                    "updated": "2023-06-29T13:00:00",
                    "id": "3db002c8-3c17-4746-9806-8e6585e913bd",
                    "user_id": 86261,
                    "agent": {
                        "$schema": "https://zenodo.org/schemas/sipstore/agent-webclient-v1.0.0.json",
                        "ip_address": "194.12.148.239",
                        "email": "ppanero@cern.ch",
                    },
                    "archivable": True,
                    "archived": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830067928"]',
                    "schema": "public",
                    "table": "sipstore_sip",
                    "txId": 533724641,
                    "lsn": 1375830067928,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938758,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "sip_id": "3db002c8-3c17-4746-9806-8e6585e913bd",
                    "filepath": "IMG_3535.jpg",
                    "file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830083728"]',
                    "schema": "public",
                    "table": "sipstore_sipfile",
                    "txId": 533724641,
                    "lsn": 1375830083728,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938758,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "sip_id": "3db002c8-3c17-4746-9806-8e6585e913bd",
                    "type_id": 1,
                    "content": {
                        "license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},
                        "owners": [86261],
                        "doi": "10.5072/zenodo.1217215",
                        "_buckets": {
                            "record": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                            "deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211",
                        },
                        "description": "<p>testing</p>",
                        "conceptdoi": "10.5072/zenodo.1217214",
                        "title": "test",
                        "_oai": {"id": "oai:zenodo.org:1217215"},
                        "_files": [
                            {
                                "checksum": "md5:3cc016be06f2be46d3a438db23c40bf3",
                                "bucket": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                                "version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba",
                                "file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                                "key": "IMG_3535.jpg",
                                "type": "jpg",
                                "size": 1562554,
                            }
                        ],
                        "conceptrecid": "1217214",
                        "recid": 1217215,
                        "_deposit": {
                            "status": "published",
                            "owners": [86261],
                            "pid": {
                                "revision_id": 0,
                                "type": "recid",
                                "value": "1217215",
                            },
                            "id": "1217215",
                            "created_by": 86261,
                        },
                        "publication_date": "2023-06-29",
                        "$schema": "https://zenodo.org/schemas/records/record-v1.0.0.json",
                        "creators": [{"name": "me"}],
                        "access_right": "open",
                        "resource_type": {"subtype": "article", "type": "publication"},
                    },
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830098696"]',
                    "schema": "public",
                    "table": "sipstore_sipmetadata",
                    "txId": 533724641,
                    "lsn": 1375830098696,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938758,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "sip_id": "3db002c8-3c17-4746-9806-8e6585e913bd",
                    "pid_id": 12132090,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830114176"]',
                    "schema": "public",
                    "table": "sipstore_recordsip",
                    "txId": 533724641,
                    "lsn": 1375830114176,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938758,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "sip_id": "3db002c8-3c17-4746-9806-8e6585e913bd",
                    "type_id": 3,
                    "content": {
                        "files": [
                            {
                                "file_uuid": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                                "sipfilepath": "IMG_3535.jpg",
                                "filepath": "data/files/e94b243e-9c0c-44df-bd1f-6decc374cf78-IMG_3535.jpg",
                                "checksum": "md5:3cc016be06f2be46d3a438db23c40bf3",
                                "fullpath": "root://eospublic.cern.ch//eos/zenodo/test/archive/121/721/5/r/2023-06-29T13:38:58.370975+00:00/data/files/e94b243e-9c0c-44df-bd1f-6decc374cf78-IMG_3535.jpg",
                                "size": 1562554,
                                "filename": "e94b243e-9c0c-44df-bd1f-6decc374cf78-IMG_3535.jpg",
                            },
                            {
                                "checksum": "md5:dfd970a277c490fa7dda545d4a53577a",
                                "metadata_id": 1,
                                "filepath": "data/metadata/record-json.json",
                                "fullpath": "root://eospublic.cern.ch//eos/zenodo/test/archive/121/721/5/r/2023-06-29T13:38:58.370975+00:00/data/metadata/record-json.json",
                                "size": 1063,
                            },
                            {
                                "content": "e94b243e-9c0c-44df-bd1f-6decc374cf78-IMG_3535.jpg IMG_3535.jpg",
                                "checksum": "md5:7f54f2e75aec7ab5dae6e1f32e949302",
                                "fullpath": "root://eospublic.cern.ch//eos/zenodo/test/archive/121/721/5/r/2023-06-29T13:38:58.370975+00:00/data/filenames.txt",
                                "filepath": "data/filenames.txt",
                                "size": 62,
                            },
                            {
                                "content": "Source-Organization: European Organization for Nuclear Research\\nOrganization-Address: CERN, CH-1211 Geneva 23, Switzerland\\nBagging-Date: 2023-06-29 13:38:58.399351\\nPayload-Oxum: 1563679.3\\nExternal-Identifier: 3db002c8-3c17-4746-9806-8e6585e913bd/SIPBagIt-v1.0.0\\nExternal-Description: BagIt archive of Zenodo record. Description of the payload structure and data interpretation available at https://doi.org/10.5281/zenodo.841781",
                                "checksum": "md5:bc83be72ab46a8349765d6bb713dfce8",
                                "fullpath": "root://eospublic.cern.ch//eos/zenodo/test/archive/121/721/5/r/2023-06-29T13:38:58.370975+00:00/bag-info.txt",
                                "filepath": "bag-info.txt",
                                "size": 427,
                            },
                            {
                                "content": "3cc016be06f2be46d3a438db23c40bf3 data/files/e94b243e-9c0c-44df-bd1f-6decc374cf78-IMG_3535.jpg\\ndfd970a277c490fa7dda545d4a53577a data/metadata/record-json.json\\n7f54f2e75aec7ab5dae6e1f32e949302 data/filenames.txt",
                                "checksum": "md5:023ee30c7031619aaba5b3efbb590051",
                                "fullpath": "root://eospublic.cern.ch//eos/zenodo/test/archive/121/721/5/r/2023-06-29T13:38:58.370975+00:00/manifest-md5.txt",
                                "filepath": "manifest-md5.txt",
                                "size": 209,
                            },
                            {
                                "content": "BagIt-Version: 0.97\\nTag-File-Character-Encoding: UTF-8",
                                "checksum": "md5:e2a83605006c61c8e9056cf9ba2b87ba",
                                "fullpath": "root://eospublic.cern.ch//eos/zenodo/test/archive/121/721/5/r/2023-06-29T13:38:58.370975+00:00/bagit.txt",
                                "filepath": "bagit.txt",
                                "size": 54,
                            },
                            {
                                "content": "bc83be72ab46a8349765d6bb713dfce8 bag-info.txt\\n023ee30c7031619aaba5b3efbb590051 manifest-md5.txt\\ne2a83605006c61c8e9056cf9ba2b87ba bagit.txt",
                                "checksum": "md5:09b6eb5dbbe7fc5e71d58073cf958d5b",
                                "fullpath": "root://eospublic.cern.ch//eos/zenodo/test/archive/121/721/5/r/2023-06-29T13:38:58.370975+00:00/tagmanifest-md5.txt",
                                "filepath": "tagmanifest-md5.txt",
                                "size": 138,
                            },
                        ],
                        "$schema": "https://zenodo.org/schemas/sipstore/bagit-v1.0.0.json",
                    },
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830124952"]',
                    "schema": "public",
                    "table": "sipstore_sipmetadata",
                    "txId": 533724641,
                    "lsn": 1375830124952,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938758,
                "transaction": None,
            },
        ],
    }
