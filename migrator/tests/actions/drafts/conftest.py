# -*- coding: utf-8 -*-
#
# Copyright (C) 2023 CERN.
#
# ZenodoRDM is free software; you can redistribute it and/or modify it
# under the terms of the MIT License; see LICENSE file for more details.

"""Migrator tests configuration."""

import pytest
from invenio_rdm_migrator.load.postgresql.transactions.operations import OperationType


@pytest.fixture()
def create_draft_tx():
    """Transaction data to create a draft.

    As it would be after the extraction step.
    """
    return {
        "tx_id": 533724568,
        "operations": [
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "K",
                    "object_type": None,
                    "object_uuid": None,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829710016"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724568,
                    "lsn": 1375829710016,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132091,
                    "pid_type": "depid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829710456"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724568,
                    "lsn": 1375829710456,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "0e12b4b6-9cc7-46df-9a04-c11c478de211",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 0,
                    "quota_size": 50000000000,
                    "max_file_size": 50000000000,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829718624"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724568,
                    "lsn": 1375829718624,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                    "json": '{"recid": 1217215,"$schema": "https://zenodo.org/schemas/deposits/records/record-v1.0.0.json","_buckets": {"deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","owners": [86261],"status": "draft","created_by": 86261},"conceptrecid": "1217214"}',
                    "version_id": 1,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929011,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829693272","1375829740696"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724568,
                    "lsn": 1375829740696,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045929132,
                "transaction": None,
            },
        ],
    }


@pytest.fixture()
def update_draft_tx():
    """Transaction data to update a draft.

    As it would be after the extraction step.
    """
    return {
        "tx_id": 533724569,
        "operations": [
            {
                "after": {
                    "created": "2021-05-01T00:00:00",
                    "updated": "2023-06-29T13:00:00",
                    "id": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                    "json": '{"doi": "","recid": 1217215,"title": "update test","$schema": "https://zenodo.org/schemas/deposits/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"owners": [86261],"status": "draft","created_by": 86261},"creators": [{"name": "me"}],"description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 2,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045929339,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829782712","1375829785112"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724586,
                    "lsn": 1375829785112,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045929643,
                "transaction": None,
            },
        ],
    }


@pytest.fixture()
def draft_publish_tx():
    """Transaction data to publish a draft.

    As it would be after the extraction step.
    """
    return {
        "tx_id": 533724590,
        "operations": [
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "K",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829894912"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829894912,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829902832"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829902832,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132092,
                    "pid_type": "doi",
                    "pid_value": "10.5072/zenodo.1217215",
                    "pid_provider": "datacite",
                    "status": "K",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829903320"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829903320,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132093,
                    "pid_type": "oai",
                    "pid_value": "oai:zenodo.org:1217215",
                    "pid_provider": "oai",
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829926648"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829926648,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132094,
                    "pid_type": "doi",
                    "pid_value": "10.5072/zenodo.1217214",
                    "pid_provider": "datacite",
                    "status": "K",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829939792"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375829939792,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                    "uri": "root://eosmedia.cern.ch//eos/media/zenodo/test/data/e9/4b/243e-9c0c-44df-bd1f-6decc374cf78/data",
                    "storage_class": "S",
                    "size": 1562554,
                    "checksum": "md5:3cc016be06f2be46d3a438db23c40bf3",
                    "readable": True,
                    "writable": False,
                    "last_check_at": 1688045937960147,
                    "last_check": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829940424"]',
                    "schema": "public",
                    "table": "files_files",
                    "txId": 533724641,
                    "lsn": 1375829940424,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "0e12b4b6-9cc7-46df-9a04-c11c478de211",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 1562554,
                    "quota_size": 50000000000,
                    "max_file_size": 50000000000,
                    "locked": True,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829948808"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829948808,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 0,
                    "quota_size": 50000000000,
                    "max_file_size": None,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829948944"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829948944,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 0,
                    "quota_size": 50000000000,
                    "max_file_size": None,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829956640"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829956640,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "bucket_id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "key": "IMG_3535.jpg",
                    "version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba",
                    "file_id": None,
                    "_mimetype": None,
                    "is_head": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829956776"]',
                    "schema": "public",
                    "table": "files_object",
                    "txId": 533724641,
                    "lsn": 1375829956776,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "default_location": 1,
                    "default_storage_class": "S",
                    "size": 1562554,
                    "quota_size": 50000000000,
                    "max_file_size": None,
                    "locked": False,
                    "deleted": False,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829970576"]',
                    "schema": "public",
                    "table": "files_bucket",
                    "txId": 533724641,
                    "lsn": 1375829970576,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                    "uri": "root://eosmedia.cern.ch//eos/media/zenodo/test/data/e9/4b/243e-9c0c-44df-bd1f-6decc374cf78/data",
                    "storage_class": "S",
                    "size": 1562554,
                    "checksum": "md5:3cc016be06f2be46d3a438db23c40bf3",
                    "readable": True,
                    "writable": False,
                    "last_check_at": 1688045937960147,
                    "last_check": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829970712"]',
                    "schema": "public",
                    "table": "files_files",
                    "txId": 533724641,
                    "lsn": 1375829970712,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "bucket_id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                    "key": "IMG_3535.jpg",
                    "version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba",
                    "file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78",
                    "_mimetype": None,
                    "is_head": True,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829970976"]',
                    "schema": "public",
                    "table": "files_object",
                    "txId": 533724641,
                    "lsn": 1375829970976,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": "2023-06-29T13:00:00",
                    "updated": "2023-06-29T13:00:00",
                    "id": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "json": '{"doi": "10.5072/zenodo.1217215","_oai": {"id": "oai:zenodo.org:1217215"},"recid": 1217215,"title": "test","_files": [{"key": "IMG_3535.jpg","size": 1562554,"type": "jpg","bucket": "930d05e3-7088-4f58-ba60-cd85fb3138c1","file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78","checksum": "md5:3cc016be06f2be46d3a438db23c40bf3","version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba"}],"owners": [86261],"$schema": "https://zenodo.org/schemas/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"record": "930d05e3-7088-4f58-ba60-cd85fb3138c1","deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","pid": {"type": "recid","value": "1217215","revision_id": 0},"owners": [86261],"status": "published","created_by": 86261},"creators": [{"name": "me"}],"conceptdoi": "10.5072/zenodo.1217214","description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 1,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375829982232"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724641,
                    "lsn": 1375829982232,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "record_id": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "bucket_id": "930d05e3-7088-4f58-ba60-cd85fb3138c1",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830001816"]',
                    "schema": "public",
                    "table": "records_buckets",
                    "txId": 533724641,
                    "lsn": 1375830001816,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id_community": "zenodo",
                    "id_record": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "id_user": None,
                    "expires_at": None,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830011336"]',
                    "schema": "public",
                    "table": "communities_community_record",
                    "txId": 533724641,
                    "lsn": 1375830011336,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                    "json": '{"doi": "10.5072/zenodo.1217215","_oai": {"id": "oai:zenodo.org:1217215"},"recid": 1217215,"title": "test","_files": [{"key": "IMG_3535.jpg","size": 1562554,"type": "jpg","bucket": "930d05e3-7088-4f58-ba60-cd85fb3138c1","file_id": "e94b243e-9c0c-44df-bd1f-6decc374cf78","checksum": "md5:3cc016be06f2be46d3a438db23c40bf3","version_id": "5f17d253-70bd-42d7-9920-3b69258c44ba"}],"owners": [86261],"$schema": "https://zenodo.org/schemas/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"record": "930d05e3-7088-4f58-ba60-cd85fb3138c1","deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","pid": {"type": "recid","value": "1217215","revision_id": 0},"owners": [86261],"status": "published","created_by": 86261},"creators": [{"name": "me"}],"conceptdoi": "10.5072/zenodo.1217214","description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 2,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830032456"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724641,
                    "lsn": 1375830032456,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": "2023-06-29T13:00:00",
                    "updated": "2023-06-29T13:00:00",
                    "id": 12132089,
                    "pid_type": "recid",
                    "pid_value": "1217214",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": None,
                    "object_uuid": None,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830034952"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375830034952,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132090,
                    "pid_type": "recid",
                    "pid_value": "1217215",
                    "pid_provider": None,
                    "status": "R",
                    "object_type": "rec",
                    "object_uuid": "1d34b5c0-70b3-474b-999f-82f537f035cd",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830035400"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375830035400,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "6519f1ac-1b3c-4691-bb1e-a507280102a4",
                    "pid_id": 12132090,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830035536"]',
                    "schema": "public",
                    "table": "pidstore_redirect",
                    "txId": 533724641,
                    "lsn": 1375830035536,
                    "xmin": None,
                },
                "op": OperationType.INSERT,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": 12132089,
                    "pid_type": "recid",
                    "pid_value": "1217214",
                    "pid_provider": None,
                    "status": "M",
                    "object_type": None,
                    "object_uuid": "6519f1ac-1b3c-4691-bb1e-a507280102a4",
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830050256"]',
                    "schema": "public",
                    "table": "pidstore_pid",
                    "txId": 533724641,
                    "lsn": 1375830050256,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "before": {
                    "created": 0,
                    "updated": 0,
                    "parent_id": 12132090,
                    "child_id": 12132091,
                    "relation_type": 0,
                    "index": None,
                },
                "after": None,
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830064184"]',
                    "schema": "public",
                    "table": "pidrelations_pidrelation",
                    "txId": 533724641,
                    "lsn": 1375830064184,
                    "xmin": None,
                },
                "op": OperationType.DELETE,
                "ts_ms": 1688045938757,
                "transaction": None,
            },
            {
                "after": {
                    "created": 1688045928842023,
                    "updated": 1688045928842023,
                    "id": "b7547ab1-47d2-48e2-9867-ca597b4ebb41",
                    "json": '{"doi": "10.5072/zenodo.1217215","_oai": {"id": "oai:zenodo.org:1217215"},"recid": 1217215,"title": "test","owners": [86261],"$schema": "https://zenodo.org/schemas/deposits/records/record-v1.0.0.json","license": {"$ref": "https://dx.zenodo.org/licenses/CC-BY-4.0"},"_buckets": {"deposit": "0e12b4b6-9cc7-46df-9a04-c11c478de211"},"_deposit": {"id": "1217215","pid": {"type": "recid","value": "1217215","revision_id": 0},"owners": [86261],"status": "published","created_by": 86261},"creators": [{"name": "me"}],"conceptdoi": "10.5072/zenodo.1217214","communities": ["zenodo"],"description": "<p>testing</p>","access_right": "open","conceptrecid": "1217214","resource_type": {"type": "publication", "subtype": "article"},"publication_date": "2023-06-29"}',
                    "version_id": 3,
                },
                "source": {
                    "version": "2.3.0.Final",
                    "connector": "postgresql",
                    "name": "zenodo-migration",
                    "ts_ms": 1688045938408,
                    "snapshot": "False",
                    "db": "zenodo",
                    "sequence": '["1375829940368","1375830064256"]',
                    "schema": "public",
                    "table": "records_metadata",
                    "txId": 533724641,
                    "lsn": 1375830064256,
                    "xmin": None,
                },
                "op": OperationType.UPDATE,
                "ts_ms": 1688045938758,
                "transaction": None,
            },
        ],
    }
